{% extends "dashboard/base.html" %}
{% block title %}Performance Analytics{% endblock %}

{% block page_title %}Performance Analytics{% endblock %}

{% block extra_head %}
<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    .analytics-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(226, 232, 240, 0.8);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }
    
    .analytics-card:hover {
        transform: translateY(-2px);
        border-color: rgba(59, 130, 246, 0.3);
        box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    .stat-number {
        background: linear-gradient(45deg, #3B82F6, #60A5FA);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .progress-bar {
        background: linear-gradient(90deg, #3B82F6, #60A5FA);
    }
</style>
{% endblock %}

{% block content %}

<!-- Header Section -->
<div class="mb-8">
    <div class="flex items-center justify-between">
        <div>
            <h2 class="text-4xl font-bold text-primary-800 dark:text-white flex items-center">
                <i data-lucide="trending-up" class="w-10 h-10 mr-4 text-accent-500 dark:text-accent-300"></i>
                Performance Analytics
            </h2>
            <p class="text-xl text-primary-600 dark:text-primary-300 mt-2">Track your interview progress and improvement over time</p>
        </div>
        <div class="flex space-x-3">
            
        </div>
    </div>
</div>

<!-- Key Stats Overview -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="analytics-card p-6 rounded-2xl">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-primary-600 text-sm font-medium">Total Sessions</p>
                <p class="stat-number text-4xl font-bold mt-1">{{ total_sessions|default:"5" }}</p>
                
            </div>
            <i data-lucide="calendar" class="w-12 h-12 text-accent-500 opacity-80"></i>
        </div>
    </div>
    
    <div class="analytics-card p-6 rounded-2xl">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-primary-600 text-sm font-medium">Avg. Score</p>
                <p class="stat-number text-4xl font-bold mt-1">{{ average_score|default:"70" }}%</p>
                
            </div>
            <i data-lucide="target" class="w-12 h-12 text-accent-500 opacity-80"></i>
        </div>
    </div>
    
    <div class="analytics-card p-6 rounded-2xl">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-primary-600 text-sm font-medium">Best Score</p>
                <p class="stat-number text-4xl font-bold mt-1">{{ best_score|default:"85" }}%</p>
                <p class="text-primary-500 text-xs mt-1">Technical interview</p>
            </div>
            <i data-lucide="trophy" class="w-12 h-12 text-amber-500 opacity-80"></i>
        </div>
    </div>
    
    <div class="analytics-card p-6 rounded-2xl">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-primary-600 text-sm font-medium">Practice Time</p>
                <p class="stat-number text-4xl font-bold mt-1">{{ total_practice_hours|default:"2" }}h</p>
                <p class="text-primary-500 text-xs mt-1">This month</p>
            </div>
            <i data-lucide="clock" class="w-12 h-12 text-accent-500 opacity-80"></i>
        </div>
    </div>
</div>

<!-- Charts Section -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    
    <!-- Performance Trends -->
    <div class="analytics-card p-6 rounded-2xl">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-semibold text-primary-800 flex items-center">
                <i data-lucide="line-chart" class="w-6 h-6 mr-3 text-accent-500"></i>
                Performance Trends
            </h3>
            <select class="bg-white text-primary-800 px-3 py-2 rounded-lg border border-primary-300 focus:border-accent-500 focus:ring-2 focus:ring-accent-200">
                <option>Last 7 days</option>
                <option>Last 30 days</option>
                <option>All time</option>
            </select>
        </div>
        <div class="h-64">
            <canvas id="performanceChart"></canvas>
        </div>
    </div>

    <!-- Skills Breakdown -->
    <div class="analytics-card p-6 rounded-2xl">
        <h3 class="text-xl font-semibold text-primary-800 mb-6 flex items-center">
            <i data-lucide="pie-chart" class="w-6 h-6 mr-3 text-accent-500"></i>
            Skills Assessment
        </h3>
        <div class="space-y-4">
            <div class="flex items-center justify-between">
                <span class="text-primary-600 font-medium">Communication</span>
                <div class="flex items-center space-x-3">
                    <div class="w-32 bg-primary-200 rounded-full h-3">
                        <div class="progress-bar h-3 rounded-full" style="width: 85%"></div>
                    </div>
                    <span class="text-primary-800 text-sm font-semibold w-8">85%</span>
                </div>
            </div>
            <div class="flex items-center justify-between">
                <span class="text-primary-600 font-medium">Technical Knowledge</span>
                <div class="flex items-center space-x-3">
                    <div class="w-32 bg-primary-200 rounded-full h-3">
                        <div class="progress-bar h-3 rounded-full" style="width: 78%"></div>
                    </div>
                    <span class="text-primary-800 text-sm font-semibold w-8">78%</span>
                </div>
            </div>
            <div class="flex items-center justify-between">
                <span class="text-primary-600 font-medium">Problem Solving</span>
                <div class="flex items-center space-x-3">
                    <div class="w-32 bg-primary-200 rounded-full h-3">
                        <div class="progress-bar h-3 rounded-full" style="width: 92%"></div>
                    </div>
                    <span class="text-primary-800 text-sm font-semibold w-8">92%</span>
                </div>
            </div>
            <div class="flex items-center justify-between">
                <span class="text-primary-600 font-medium">Confidence</span>
                <div class="flex items-center space-x-3">
                    <div class="w-32 bg-primary-200 rounded-full h-3">
                        <div class="progress-bar h-3 rounded-full" style="width: 73%"></div>
                    </div>
                    <span class="text-primary-800 text-sm font-semibold w-8">73%</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Sessions Table -->
<div class="analytics-card p-6 rounded-2xl">
    <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-semibold text-primary-800 flex items-center">
            <i data-lucide="list" class="w-6 h-6 mr-3 text-accent-500"></i>
            Recent Sessions
        </h3>
        <a href="{% url 'dashboard:my_sessions' %}" class="text-accent-600 hover:text-accent-700 transition-colors text-sm font-medium">
            View all sessions â†’
        </a>
    </div>
    
    <div class="overflow-x-auto">
        <table class="w-full text-left">
            <thead>
                <tr class="border-b border-primary-200">
                    <th class="pb-3 text-primary-600 font-semibold">Date</th>
                    <th class="pb-3 text-primary-600 font-semibold">Type</th>
                    <th class="pb-3 text-primary-600 font-semibold">Duration</th>
                    <th class="pb-3 text-primary-600 font-semibold">Score</th>
                    <th class="pb-3 text-primary-600 font-semibold">Status</th>
                </tr>
            </thead>
            <tbody class="text-primary-800">
                {% for session in recent_sessions %}
                <tr class="border-b border-primary-100 hover:bg-primary-50 transition-colors">
                    <td class="py-4">{{ session.started_at|date:"M d, Y" }}</td>
                    <td class="py-4">
                        <span class="px-3 py-1 bg-accent-100 text-accent-700 rounded-full text-xs font-medium">
                            {{ session.interview_details.mode|title }}
                        </span>
                    </td>
                    <td class="py-4">{{ session.duration_minutes|floatformat:0 }}min</td>
                    <td class="py-4">
                        <span class="font-bold text-lg text-accent-600">{{ session.overall_confidence_score|default:"N/A" }}%</span>
                    </td>
                    <td class="py-4">
                        {% if session.status == 'completed' %}
                            <span class="text-green-600 flex items-center font-medium">
                                <i data-lucide="check-circle" class="w-4 h-4 mr-1"></i>
                                Completed
                            </span>
                        {% elif session.status == 'active' %}
                            <span class="text-amber-600 flex items-center font-medium">
                                <i data-lucide="play-circle" class="w-4 h-4 mr-1"></i>
                                Active
                            </span>
                        {% else %}
                            <span class="text-primary-500 font-medium">{{ session.status|title }}</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="py-12 text-center">
                        <i data-lucide="inbox" class="w-16 h-16 mx-auto mb-4 text-primary-400"></i>
                        <p class="text-primary-600 text-lg mb-4">No interview sessions found</p>
                        <p class="text-primary-500 mb-6">Start your first session to see analytics!</p>
                        <a href="{% url 'dashboard:category' %}" class="inline-block px-6 py-3 bg-accent-500 hover:bg-accent-600 text-white rounded-xl transition-colors font-semibold">
                            Start New Session
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script>
    // Initialize Lucide Icons
    lucide.createIcons();
    
    // Performance Chart
    const ctx = document.getElementById('performanceChart');
    if (ctx) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Interview Score',
                    data: [65, 72, 68, 78, 85, 82, 88],
                    borderColor: '#3B82F6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: '#3B82F6',
                    pointBorderColor: '#FFFFFF',
                    pointBorderWidth: 2,
                    pointRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            color: '#475569',
                            callback: function(value) {
                                return value + '%';
                            }
                        },
                        grid: {
                            color: 'rgba(203, 213, 225, 0.5)'
                        }
                    },
                    x: {
                        ticks: {
                            color: '#475569'
                        },
                        grid: {
                            color: 'rgba(203, 213, 225, 0.5)'
                        }
                    }
                }
            }
        });
    }
</script>
{% endblock %}